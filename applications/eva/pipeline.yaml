steps:
  build:
    targets:
      - //applications/eva:eva

  unit_test:
    targets:
      - //applications/eva/src/app/...
      - //applications/eva/src/domain/...
      - //applications/eva/src/ports/...

  push_image:
    targets:
      - //applications/eva:publish-testing

  integration_test:
    setup:
      dockerfile:
        - ./applications/eva/docker-compose.ci.yaml
    network_dependencies:
      - host: eva
        port: 8000
    targets:
      - //applications/eva/src/adapters/...
      - //applications/eva/src/service/...

  e2e_test:
    setup:
      dockerfile:
        - ./applications/eva/docker-compose.ci.yaml
    network_dependencies:
      - host: eva
        port: 8000

  publish_image:
    targets:
      - //applications/eva:publish